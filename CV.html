<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Advanced CV Builder</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f7f8;
    padding: 20px;
  }
  .container {
    max-width: 700px;
    margin: auto;
    background: white;
    padding: 20px 30px 40px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
    color: #333;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
  }
  input[type="text"],
  input[type="email"],
  input[type="tel"],
  textarea {
    width: 100%;
    padding: 8px;
    margin-top: 6px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }
  textarea {
    resize: vertical;
    height: 80px;
  }
  button {
    margin-top: 20px;
    background: #0070f3;
    color: white;
    border: none;
    padding: 12px;
    width: 100%;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover {
    background: #0051c3;
  }
  .add-btn {
    background: #28a745;
    margin: 10px 0 20px 0;
    width: auto;
    padding: 8px 15px;
  }
  .section-group {
    margin-bottom: 10px;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 6px;
    position: relative;
  }
  .remove-btn {
    position: absolute;
    top: 60px;
    right: 6px;
    background: #dc3545;
    border: none;
    color: white;
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    padding: 0 6px;
  }
  #preview {
    margin-top: 30px;
    padding: 15px;
    background: #e9ecef;
    border-radius: 6px;
    white-space: pre-wrap;
    font-family: monospace;
    max-height: 400px;
    overflow-y: auto;
  }
  #profilePreview {
    display: block;
    margin: 10px auto;
    max-width: 120px;
    border-radius: 50%;
    border: 2px solid #0070f3;
  }
</style>
</head>
<body>
  <div class="container">
    <h2>Advanced CV Builder</h2>
    <form id="cvForm">
      <label for="fullName">Full Name</label>
      <input type="text" id="fullName" required />

      <label for="email">Email</label>
      <input type="email" id="email" required />

      <label for="phone">Phone</label>
      <input type="tel" id="phone" />

      <label for="address">Address</label>
      <textarea id="address"></textarea>

      <label for="profilePic">Profile Photo</label>
      <input type="file" id="profilePic" accept="image/*" />
      <img id="profilePreview" src="" alt="Profile Preview" style="display:none" />

      <h3>Education</h3>
      <div id="educationList"></div>
      <button type="button" class="add-btn" id="addEducationBtn">+ Add Education</button>

      <h3>Experience</h3>
      <div id="experienceList"></div>
      <button type="button" class="add-btn" id="addExperienceBtn">+ Add Experience</button>

      <label for="skills">Skills</label>
      <textarea id="skills" placeholder="List your skills"></textarea>

      <button type="submit">Download CV as PDF</button>
    </form>

    <h3>CV Preview</h3>
    <pre id="preview">(Fill the form to see preview here)</pre>
  </div>

  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const { jsPDF } = window.jspdf;

    // Dynamic Education & Experience sections
    const educationList = document.getElementById('educationList');
    const experienceList = document.getElementById('experienceList');
    const addEducationBtn = document.getElementById('addEducationBtn');
    const addExperienceBtn = document.getElementById('addExperienceBtn');

    function createSectionInput(type) {
      const div = document.createElement('div');
      div.className = 'section-group';

      const input = document.createElement('textarea');
      input.placeholder = type === 'education' ? 
        'Degree, Institution, Year' : 
        'Job Title, Company, Years worked';

      div.appendChild(input);

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = 'Ã—';
      removeBtn.title = 'Remove';
      removeBtn.onclick = () => div.remove();

      div.appendChild(removeBtn);
      return div;
    }

    addEducationBtn.onclick = () => {
      educationList.appendChild(createSectionInput('education'));
    };
    addExperienceBtn.onclick = () => {
      experienceList.appendChild(createSectionInput('experience'));
    };

    // Add one input initially for user convenience
    addEducationBtn.click();
    addExperienceBtn.click();

    // Profile photo preview
    const profilePicInput = document.getElementById('profilePic');
    const profilePreview = document.getElementById('profilePreview');
    let profileImgDataUrl = '';

    profilePicInput.addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          profileImgDataUrl = e.target.result;
          profilePreview.src = profileImgDataUrl;
          profilePreview.style.display = 'block';
          updatePreview();
        };
        reader.readAsDataURL(file);
      } else {
        profilePreview.style.display = 'none';
        profileImgDataUrl = '';
        updatePreview();
      }
    });

    // Preview update
    const preview = document.getElementById('preview');
    const form = document.getElementById('cvForm');

    function getMultipleValues(container) {
      const values = [];
      container.querySelectorAll('textarea').forEach(t => {
        if (t.value.trim()) values.push(t.value.trim());
      });
      return values;
    }

    function updatePreview() {
      const fullName = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      const education = getMultipleValues(educationList);
      const experience = getMultipleValues(experienceList);
      const skills = document.getElementById('skills').value.trim();

      let text = '';
      if (fullName) text += fullName + '\n\n';
      if (email) text += `Email: ${email}\n`;
      if (phone) text += `Phone: ${phone}\n`;
      if (address) text += `Address: ${address}\n\n`;

      if (education.length) {
        text += 'Education:\n';
        education.forEach((e, i) => text += ` ${i + 1}. ${e}\n`);
        text += '\n';
      }
      if (experience.length) {
        text += 'Experience:\n';
        experience.forEach((e, i) => text += ` ${i + 1}. ${e}\n`);
        text += '\n';
      }
      if (skills) {
        text += 'Skills:\n';
        text += skills + '\n';
      }

      preview.textContent = text || '(Fill the form to see preview here)';
    }

    form.addEventListener('input', updatePreview);
    educationList.addEventListener('input', updatePreview);
    experienceList.addEventListener('input', updatePreview);

    updatePreview();

    // PDF generation
    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const fullName = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      const education = getMultipleValues(educationList);
      const experience = getMultipleValues(experienceList);
      const skills = document.getElementById('skills').value.trim();

      const doc = new jsPDF();

      // Add profile photo if exists
      if (profileImgDataUrl) {
        // Add image in PDF (position x=150,y=10, width=40, height=40)
        doc.addImage(profileImgDataUrl, 'JPEG', 150, 10, 40, 40);
      }

      doc.setFontSize(22);
      doc.setTextColor('#0070f3');
      doc.text(fullName, 20, 20);

      doc.setFontSize(12);
      doc.setTextColor('#000');
      doc.text(`Email: ${email}`, 20, 30);
      if (phone) doc.text(`Phone: ${phone}`, 20, 37);
      if (address) doc.text(`Address: ${address}`, 20, 44);

      let y = 60;

      if (education.length) {
        doc.setFontSize(16);
        doc.setTextColor('#0070f3');
        doc.text("Education", 20, y);
        y += 7;
        doc.setFontSize(12);
        doc.setTextColor('#000');
        education.forEach((e, i) => {
          doc.text(`- ${e}`, 20, y);
          y += 7;
        });
        y += 5;
      }

      if (experience.length) {
        doc.setFontSize(16);
        doc.setTextColor('#0070f3');
        doc.text("Experience", 20, y);
        y += 7;
        doc.setFontSize(12);
        doc.setTextColor('#000');
        experience.forEach((e, i) => {
          doc.text(`- ${e}`, 20, y);
          y += 7;
        });
        y += 5;
      }

      if (skills) {
        doc.setFontSize(16);
        doc.setTextColor('#0070f3');
        doc.text("Skills", 20, y);
        y += 7;
        doc.setFontSize(12);
        doc.setTextColor('#000');
        const splitSkills = doc.splitTextToSize(skills, 170);
        doc.text(splitSkills, 20, y);
      }

      doc.save(`${fullName}_CV.pdf`);
    });
  </script>
</body>
</html>
